<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Hash;
use App\Http\Controllers\Controller;
use App\Http\Requests;
use App\Http\Helper;

class UserNotificationController extends Controller {
    
    /*
     * Request Parameter : [Apikey]
     * Method : POST
     * Request Api Url : "/api/notificationlist"
     * Request Controller & Method : UserNotificationController/NotificationList
     * Success response : [ message : Success.,  code : 200, data: Array of Notification]
     * Error response : 
     * 1)[ message : Unauthorised Call. , code : 101]
       2)[ message : Notification doesnot avilable. , code : 101]
     */
   
    public function NotificationList(Request $request) {
        $Apikey = $request->Apikey;
        if ($Apikey == APIKEY) {
            $Push_notification = DB::table('push_notification')->get();
            if (count($Push_notification) > 0) {
                foreach ($Push_notification as $notification) {
                    $Push_notification->id = !empty($notification->id) ? (int) $notification->id : '';
                }
                return response()->json(['message' => 'Success', 'code' => 200, 'data' => $Push_notification]);
            } else {
                return response()->json(['message' => 'Notification doesnot avilable', 'code' => 101]);
            }
        } else {
            return response()->json(['message' => 'Unauthorised Call', 'code' => 101]);
        }
    }

    /*
     * Request Parameter : [Apikey, notification_id, mode]
     * Method : POST
     * Request Api Url : "/api/changenotificationmode"
     * Request Controller & Method : UserNotificationController/changeNotificationMode
     * Success response : [ message : Notification mode change successfully.,  code : 200]
     * Error response : 
     * 1)[ message : Unauthorised Call. , code : 101]
       2)[ message : Notification mode doesnot change successfully. , code : 101]
     */
    public function changeNotificationMode(Request $request) {
        $id = $request->notification_id;
        $Mode = $request->mode;
        $Apikey = $request->Apikey;
        if ($Apikey == APIKEY) {
            $notification_update = DB::table('push_notification')->where('id', $id)->update([
                'notification_mode' => $Mode,
                'updated_date' => Helper::get_curr_datetime()
            ]);

            if($notification_update){
                return response()->json(['message' => 'Notification mode change successfully.', 'code' => 200]);
            }
            return response()->json(['message' => 'Notification mode doesnot change successfully.', 'code' => 101]);
        } else {
            return response()->json(['message' => 'Unauthorised Call', 'code' => 101]);
        }
    }

}
